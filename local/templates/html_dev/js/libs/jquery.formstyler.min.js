!function(e){e.fn.styler=function(s){var t=e.extend({wrapper:"form",idSuffix:"-styler",filePlaceholder:"Файл не выбран",fileBrowse:"Обзор...",selectSearch:!0,selectSearchLimit:10,selectSearchNotFound:"Совпадений не найдено",selectSearchPlaceholder:"Поиск...",selectVisibleOptions:0,singleSelectzIndex:"100",selectSmartPositioning:!0,onSelectOpened:function(){},onSelectClosed:function(){},onFormStyled:function(){}},s);return this.each(function(){function s(){var e="",s="",i="",o="";void 0!==l.attr("id")&&""!==l.attr("id")&&(e=' id="'+l.attr("id")+t.idSuffix+'"'),void 0!==l.attr("title")&&""!==l.attr("title")&&(s=' title="'+l.attr("title")+'"'),void 0!==l.attr("class")&&""!==l.attr("class")&&(i=" "+l.attr("class"));for(var c=l.data(),n=0;n<c.length;n++)""!==c[n]&&(o+=" data-"+n+'="'+c[n]+'"');e+=o,this.id=e,this.title=s,this.classes=i}var l=e(this);l.is(":checkbox")?l.each(function(){if(l.parent("div.jq-checkbox").length<1){var t=function(){var t=new s,i=e("<div"+t.id+' class="jq-checkbox'+t.classes+'"'+t.title+'><div class="jq-checkbox__div"></div></div>');l.css({position:"absolute",zIndex:"-1",opacity:0,margin:0,padding:0}).after(i).prependTo(i),i.attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none",display:"inline-block",position:"relative",overflow:"hidden"}),l.is(":checked")&&i.addClass("checked"),l.is(":disabled")&&i.addClass("disabled"),i.on("click.styler",function(){return!i.is(".disabled")&&(l.is(":checked")?(l.prop("checked",!1),i.removeClass("checked")):(l.prop("checked",!0),i.addClass("checked")),l.change(),!1)}),l.closest("label").add('label[for="'+l.attr("id")+'"]').click(function(e){i.click(),e.preventDefault()}),l.on("change.styler",function(){l.is(":checked")?i.addClass("checked"):i.removeClass("checked")}).on("keydown.styler",function(e){32==e.which&&i.click()}).on("focus.styler",function(){i.is(".disabled")||i.addClass("focused")}).on("blur.styler",function(){i.removeClass("focused")})};t(),l.on("refresh",function(){l.off(".styler").parent().before(l).remove(),t()})}}):l.is(":radio")?l.each(function(){if(l.parent("div.jq-radio").length<1){var i=function(){var i=new s,o=e("<div"+i.id+' class="jq-radio'+i.classes+'"'+i.title+'><div class="jq-radio__div"></div></div>');l.css({position:"absolute",zIndex:"-1",opacity:0,margin:0,padding:0}).after(o).prependTo(o),o.attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none",display:"inline-block",position:"relative"}),l.is(":checked")&&o.addClass("checked"),l.is(":disabled")&&o.addClass("disabled"),o.on("click.styler",function(){return!o.is(".disabled")&&(o.closest(t.wrapper).find('input[name="'+l.attr("name")+'"]').prop("checked",!1).parent().removeClass("checked"),l.prop("checked",!0).parent().addClass("checked"),l.change(),!1)}),l.closest("label").add('label[for="'+l.attr("id")+'"]').click(function(e){o.click(),e.preventDefault()}),l.on("change.styler",function(){l.parent().addClass("checked")}).on("focus.styler",function(){o.is(".disabled")||o.addClass("focused")}).on("blur.styler",function(){o.removeClass("focused")})};i(),l.on("refresh",function(){l.off(".styler").parent().before(l).remove(),i()})}}):l.is(":file")?l.css({position:"absolute",top:0,right:0,width:"100%",height:"100%",opacity:0,margin:0,padding:0}).each(function(){if(l.parent("div.jq-file").length<1){var i=function(){var i=new s,o=e("<div"+i.id+' class="jq-file'+i.classes+'"'+i.title+' style="display: inline-block; position: relative; overflow: hidden"></div>'),c=e('<div class="jq-file__name">'+t.filePlaceholder+"</div>").appendTo(o);e('<div class="jq-file__browse">'+t.fileBrowse+"</div>").appendTo(o);l.after(o),o.append(l),l.is(":disabled")&&o.addClass("disabled"),l.on("change.styler",function(){var e=l.val();if(l.is("[multiple]")){e="";for(var s=l[0].files,i=0;i<s.length;i++)e+=(i>0?", ":"")+s[i].name}c.text(e.replace(/.+[\\\/]/,"")),""===e?(c.text(t.filePlaceholder),o.removeClass("changed")):o.addClass("changed")}).on("focus.styler",function(){o.addClass("focused")}).on("blur.styler",function(){o.removeClass("focused")}).on("click.styler",function(){o.removeClass("focused")})};i(),l.on("refresh",function(){l.off(".styler").parent().before(l).remove(),i()})}}):l.is("select")?l.each(function(){if(l.parent("div.jqselect").length<1){var o=function(){function o(s){s.off("mousewheel DOMMouseScroll").on("mousewheel DOMMouseScroll",function(s){var t=null;"mousewheel"==s.type?t=s.originalEvent.wheelDelta*-1:"DOMMouseScroll"==s.type&&(t=40*s.originalEvent.detail),t&&(s.stopPropagation(),s.preventDefault(),e(this).scrollTop(t+e(this).scrollTop()))})}function c(){for(i=0,len=n.length;i<len;i++){var e="",s="",t="",l="",o="",c="";n.eq(i).prop("selected")&&(s="selected sel"),n.eq(i).is(":disabled")&&(s="disabled"),n.eq(i).is(":selected:disabled")&&(s="selected sel disabled"),void 0!==n.eq(i).attr("class")&&(l=" "+n.eq(i).attr("class"),c=' data-jqfs-class="'+n.eq(i).attr("class")+'"');var d=n.eq(i).data();for(var r in d)""!==d[r]&&(t+=" data-"+r+'="'+d[r]+'"');e="<li"+c+t+' class="'+s+l+'">'+n.eq(i).text()+"</li>",n.eq(i).parent().is("optgroup")&&(void 0!==n.eq(i).parent().attr("class")&&(o=" "+n.eq(i).parent().attr("class")),e="<li"+c+' class="'+s+l+" option"+o+'">'+n.eq(i).text()+"</li>",n.eq(i).is(":first-child")&&(e='<li class="optgroup'+o+'">'+n.eq(i).parent().attr("label")+"</li>"+e)),a+=e}}var n=e("option",l),a="";l.is("[multiple]")?function(){var t=new s,i=e("<div"+t.id+' class="jq-select-multiple jqselect'+t.classes+'"'+t.title+' style="display: inline-block; position: relative"></div>');l.css({margin:0,padding:0}).after(i),c(),i.append("<ul>"+a+"</ul>");var d=e("ul",i).css({position:"relative","overflow-x":"hidden","-webkit-overflow-scrolling":"touch"}),r=e("li",i).attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none","white-space":"nowrap"}),h=l.attr("size"),f=d.outerHeight(),p=r.outerHeight();void 0!==h&&h>0?d.css({height:p*h}):d.css({height:4*p}),f>i.height()&&(d.css("overflowY","scroll"),o(d),r.filter(".selected").length&&d.scrollTop(d.scrollTop()+r.filter(".selected").position().top)),l.prependTo(i).css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0}),l.is(":disabled")?(i.addClass("disabled"),n.each(function(){e(this).is(":selected")&&r.eq(e(this).index()).addClass("selected")})):(r.filter(":not(.disabled):not(.optgroup)").click(function(s){l.trigger("focus.styler"),i.removeClass("focused");var t=e(this);if(s.ctrlKey||s.metaKey||t.addClass("selected"),s.shiftKey||t.addClass("first"),s.ctrlKey||s.metaKey||s.shiftKey||t.siblings().removeClass("selected first"),(s.ctrlKey||s.metaKey)&&(t.is(".selected")?t.removeClass("selected first"):t.addClass("selected first"),t.siblings().removeClass("first")),s.shiftKey){var o=!1,c=!1;t.siblings().removeClass("selected").siblings(".first").addClass("selected"),t.prevAll().each(function(){e(this).is(".first")&&(o=!0)}),t.nextAll().each(function(){e(this).is(".first")&&(c=!0)}),o&&t.prevAll().each(function(){if(e(this).is(".selected"))return!1;e(this).not(".disabled, .optgroup").addClass("selected")}),c&&t.nextAll().each(function(){if(e(this).is(".selected"))return!1;e(this).not(".disabled, .optgroup").addClass("selected")}),1==r.filter(".selected").length&&t.addClass("first")}n.prop("selected",!1),r.filter(".selected").each(function(){var s=e(this),t=s.index();s.is(".option")&&(t-=s.prevAll(".optgroup").length),n.eq(t).prop("selected",!0)}),l.trigger("change.styler")}),n.each(function(s){e(this).data("optionIndex",s)}),l.on("change.styler",function(){r.removeClass("selected");var s=[];n.filter(":selected").each(function(){s.push(e(this).data("optionIndex"))}),r.not(".optgroup").filter(function(t){return e.inArray(t,s)>-1}).addClass("selected")}).on("focus.styler",function(){i.addClass("focused")}).on("blur.styler",function(){i.removeClass("focused")}),f>i.height()&&l.on("keydown.styler",function(e){38!=e.which&&37!=e.which&&33!=e.which||d.scrollTop(d.scrollTop()+r.filter(".selected").position().top-p),40!=e.which&&39!=e.which&&34!=e.which||d.scrollTop(d.scrollTop()+r.filter(".selected:last").position().top-d.innerHeight()+2*p)}))}():function(){var i=new s,d=e("<div"+i.id+' class="jq-selectbox jqselect'+i.classes+'" style="display: inline-block; position: relative; z-index:'+t.singleSelectzIndex+'"><div class="jq-selectbox__select"'+i.title+' style="position: relative"><div class="jq-selectbox__select-text"></div><div class="jq-selectbox__trigger"><div class="jq-selectbox__trigger-arrow"></div></div></div></div>');l.css({margin:0,padding:0}).after(d).prependTo(d);var r=e("div.jq-selectbox__select",d),h=e("div.jq-selectbox__select-text",d),f=n.filter(":selected");f.length?h.html(f.text()):h.html(n.first().text()),c();var p="";t.selectSearch&&(p='<div class="jq-selectbox__search"><input type="search" autocomplete="off" placeholder="'+t.selectSearchPlaceholder+'"></div><div class="jq-selectbox__not-found">'+t.selectSearchNotFound+"</div>");var u=e('<div class="jq-selectbox__dropdown" style="position: absolute">'+p+'<ul class="list-reset" style="position: relative; list-style: none; overflow: auto; overflow-x: hidden">'+a+"</ul></div>");d.append(u);var v=e("ul",u),g=e("li",u),b=e("input",u),m=e("div.jq-selectbox__not-found",u).hide();g.length<t.selectSearchLimit&&b.parent().hide();var y=0,x=0;g.each(function(){var s=e(this);s.css({display:"inline-block","white-space":"nowrap"}),s.innerWidth()>y&&(y=s.innerWidth(),x=s.width()),s.css({display:"block"})});var w=d.clone().appendTo("body").width("auto"),C=w.width();w.remove(),C==d.width()&&(h.width(x),y+=d.find("div.jq-selectbox__trigger").width()),y>d.width()&&u.width(y),l.css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0});var q=d.outerHeight(),k=b.outerHeight(),j=v.css("max-height"),_=g.filter(".selected");_.length<1&&g.first().addClass("selected sel"),void 0===g.data("li-height")&&g.data("li-height",g.outerHeight());var S=u.css("top");if("auto"==u.css("left")&&u.css({left:0}),"auto"==u.css("top")&&u.css({top:q}),u.hide(),_.length&&(n.first().text()!=f.text()&&d.addClass("changed"),d.data("jqfs-class",_.data("jqfs-class")),d.addClass(_.data("jqfs-class"))),l.is(":disabled"))return d.addClass("disabled"),!1;r.click(function(){if(l.focus(),e("div.jq-selectbox").filter(".opened").length&&t.onSelectClosed.call(e("div.jq-selectbox").filter(".opened")),!navigator.userAgent.match(/(iPad|iPhone|iPod)/g)){var s=g.data("li-height");if(t.selectSmartPositioning){var i=e(window),c=d.offset().top,n=i.height()-q-(c-i.scrollTop()),a=t.selectVisibleOptions,r=5*s,h=s*a;if(a>0&&a<6&&(r=h),0===a&&(h="auto"),n>r+k+20){u.height("auto").css({bottom:"auto",top:S});var f=function(){v.css("max-height",Math.floor((n-20-k)/s)*s)};f(),v.css("max-height",h),"none"!=j&&v.css("max-height",j),n<u.outerHeight()+20&&f()}else{u.height("auto").css({top:"auto",bottom:S});var p=function(){v.css("max-height",Math.floor((c-i.scrollTop()-20-k)/s)*s)};p(),v.css("max-height",h),"none"!=j&&v.css("max-height",j),c-i.scrollTop()-20<u.outerHeight()+20&&p()}}return e("div.jqselect").css({zIndex:t.singleSelectzIndex-1}).removeClass("opened"),d.css({zIndex:t.singleSelectzIndex}),u.is(":hidden")?(e("div.jq-selectbox__dropdown:visible").hide(),u.show(),d.addClass("opened focused"),t.onSelectOpened.call(d)):(u.hide(),d.removeClass("opened"),e("div.jq-selectbox").filter(".opened").length&&t.onSelectClosed.call(d)),g.filter(".selected").length&&(v.innerHeight()/s%2!=0&&(s/=2),v.scrollTop(v.scrollTop()+g.filter(".selected").position().top-v.innerHeight()/2+s)),b.length&&(b.val("").keyup(),m.hide(),b.keyup(function(){var s=e(this).val();g.each(function(){e(this).html().match(new RegExp(".*?"+s+".*?","i"))?e(this).show():e(this).hide()}),g.filter(":visible").length<1?m.show():m.hide()})),o(v),!1}}),g.hover(function(){e(this).siblings().removeClass("selected")});var T=g.filter(".selected").text();g.filter(".selected").text(),g.filter(":not(.disabled):not(.optgroup)").click(function(){var s=e(this),i=s.text();if(T!=i){var o=s.index();o-=s.prevAll(".optgroup").length,s.addClass("selected sel").siblings().removeClass("selected sel"),n.prop("selected",!1).eq(o).prop("selected",!0),T=i,h.html(i),d.data("jqfs-class")&&d.removeClass(d.data("jqfs-class")),d.data("jqfs-class",s.data("jqfs-class")),d.addClass(s.data("jqfs-class")),l.change()}b.length&&(b.val("").keyup(),m.hide()),u.hide(),d.removeClass("opened"),t.onSelectClosed.call(d)}),u.mouseout(function(){e("li.sel",u).addClass("selected")}),l.on("change.styler",function(){h.html(n.filter(":selected").text()),g.removeClass("selected sel").not(".optgroup").eq(l[0].selectedIndex).addClass("selected sel"),n.first().text()!=g.filter(".selected").text()?d.addClass("changed"):d.removeClass("changed")}).on("focus.styler",function(){d.addClass("focused"),e("div.jqselect").removeClass("opened")}).on("blur.styler",function(){d.removeClass("focused")}).on("keydown.styler keyup.styler",function(e){var s=g.data("li-height");h.html(n.filter(":selected").text()),g.removeClass("selected sel").not(".optgroup").eq(l[0].selectedIndex).addClass("selected sel"),38!=e.which&&37!=e.which&&33!=e.which&&36!=e.which||v.scrollTop(v.scrollTop()+g.filter(".selected").position().top),40!=e.which&&39!=e.which&&34!=e.which&&35!=e.which||v.scrollTop(v.scrollTop()+g.filter(".selected").position().top-v.innerHeight()+s),32==e.which&&e.preventDefault(),13==e.which&&(e.preventDefault(),u.hide())}),e(document).on("click",function(s){e(s.target).parents().hasClass("jq-selectbox")||"OPTION"==s.target.nodeName||(e("div.jq-selectbox").filter(".opened").length&&t.onSelectClosed.call(e("div.jq-selectbox").filter(".opened")),b.length&&b.val("").keyup(),u.hide().find("li.sel").addClass("selected"),d.removeClass("focused opened"))})}()};o(),l.on("refresh",function(){l.off(".styler").parent().before(l).remove(),o()})}}):l.is(":reset")&&l.on("click",function(){setTimeout(function(){l.closest(t.wrapper).find("input, select").trigger("refresh")},1)})}).promise().done(function(){t.onFormStyled.call()})}}(jQuery);